<!DOCTYPE html>
<html>
    <head>
        <title>IMD3901 A3</title>
        <meta charset="utf-8" />
        <script src="https://aframe.io/releases/1.1.0/aframe.min.js"></script>
        <script src="https://unpkg.com/aframe-environment-component@1.2.0/dist/aframe-environment-component.min.js"></script>
        <script src="/socket.io/socket.io.js"></script>
        
    </head>

    <body>
        <a-scene >
            <a-entity camera wasd-controls look-controls position="0 1.6 14">
                <a-entity cursor="rayOrigin:mouse;" raycaster="far:5; interval:200; objects:.interactive"></a-entity>
            </a-entity>

            <a-entity class="ground"  geometry="primitive:plane; width:14; height:14;" scale = "1 -0.877 1" material="color:white;" position="0 0.01 0" rotation="-90 0 0"></a-entity>


            <!-- blue button -->
            <a-entity id="blue_button" position="0.076 0.6 12.101">
                <a-entity class="button interactive" position="0 0.6 0" geometry="primitive:cylinder; radius:0.15; height:0.2;" material="color:rgb(100, 100, 255)"
                            animation__mouseenter="property:material.color; type:color; to:rgb(0, 0, 255); startEvents:mouseenter; dur:200"
                            animation__mouseleave="property:material.color; type:color; to:rgb(100, 100, 255); startEvents:mouseleave; dur:200"
                            animation__click="property:position.y; from:0.55; to:0.6; startEvents:click; dur:300" shadow></a-entity>
                <a-entity position="0 0.3 0" geometry="primitive:box; width:0.5; depth:0.5; height:0.6;" material="color:rgb(255, 255, 255)" shadow></a-entity>
            </a-entity>

            <a-entity environment="preset: forest; groundColor: #445; grid: cross"></a-entity>

        </a-scene>

        <!--loads script after html-->
        <script>
            let socket = io();

            socket.on('connect', (userData) => {
                console.log('I exist!');

                //put code here so that we know that socket.io has initailized ...
                document.querySelector('#blue_button').querySelector('.button').addEventListener('click', function(){
                    socket.emit('blueBox');
                });


                //listen to event from server
                 socket.on('blueBox_added', (data) => {
                    
                    var sceneEl = document.querySelector('a-scene'); 

                    var boxEl = document.createElement('a-box'); 
                    boxEl.setAttribute('id', 'blueBox');
                    boxEl.setAttribute('material', {color: '#8888FF'});
                    boxEl.setAttribute('position', {x: Math.random() * (6.498 - (-6.476) + 1) + (-6.476), y: Math.random() * (2.5 - 0.517 + 1) + 0.517 , z: Math.random() * (5.635 - (-5.65) + 1) + (-5.65) });
                    boxEl.setAttribute('scale', "0.5 0.5 0.5");
                    sceneEl.appendChild(boxEl);
                    
                });

                let ids = 0; 
                var els = [];
                let newLength = 0;
                
                socket.on('redBox_added', (data) => {
                    
                    var sceneEl = document.querySelector('a-scene'); 
                   
                    var boxEl = document.createElement('a-box');
                    boxEl.setAttribute('material', {color: '#FF8888'});
                    boxEl.setAttribute('id', 'redBox');
                    boxEl.setAttribute('class', 'box interactive');
                    boxEl.setAttribute('position', {x: Math.random() * (6.498 - (-6.476) + 1) + (-6.476), y: Math.random() * (2.5 - 0.517 + 1) + 0.517 , z: Math.random() * (5.635 - (-5.65) + 1) + (-5.65) });
                    boxEl.setAttribute('scale', "0.5 0.5 0.5");
                    sceneEl.appendChild(boxEl);

                    var newItem = sceneEl.querySelector('#redBox');

                    newLength = els.push(newItem);
                    ids ++;
                    //console.log(newLength);
                    //console.log(els);

                        
                    newItem.addEventListener('click', function(){
                    socket.emit('purpleBox2');
                    });  

                    
                });

                let ids2 = 0; 
                var els2 = [];
                let newLength2 = 0;

                socket.on('purple2', (data) => {
                    var sceneEl = document.querySelector('a-scene'); 
                    
                    //blueCube  = document.querySelector('#blueBox');
                    redCube  = document.querySelector('#redBox');

                    if(redCube != null){
                        let colorStr = 'rgb(' + data.r + ',' + data.g + ',' + data.b + ')';

                        redCube.setAttribute('material', {color:colorStr});

                        cube2 = (redCube.getAttribute("position"));

                        redCube.setAttribute('id', 'purpleBox');

                        purpleCube  = document.querySelector('#purpleBox');

                        newLength2 = els2.push(purpleCube);
                        ids2 ++;
                        console.log(newLength2);
                        console.log(els2);

                        if(purpleCube != null){
                            purpleCube.addEventListener('click', function(){
                                socket.emit('changeBlue');
                                }); 
                        }   
                    }
                       
                    
                });

                socket.on('purple1', (data) => {
                    var sceneEl = document.querySelector('a-scene'); 
                    
                    blueCube  = document.querySelector('#blueBox');

                    if(blueCube != null){
                        let colorStr = 'rgb(' + data.r + ',' + data.g + ',' + data.b + ')';

                        blueCube.setAttribute('material', {color:colorStr});
                        blueCube.setAttribute('class', 'box interactive');

                        //cube = (blueCube.getAttribute("position"));
                        //console.log(cube);

                        blueCube.setAttribute('id', 'purpleBox');

                        purpleCube  = document.querySelector('#purpleBox');

                        newLength2 = els2.push(purpleCube);
                        ids2 ++;
                        console.log(newLength2);
                        console.log(els2);

                        if(purpleCube != null){
                            purpleCube.addEventListener('click', function(){
                                socket.emit('changeBlue');
                                }); 
                        }   
                    }
                              
                    
                });

                socket.on('blueBox_changed', (data) => {
                    var sceneEl = document.querySelector('a-scene'); 
                    
                    purpleCube  = document.querySelector('#purpleBox');

                    if(purpleCube != null){ 
                        let colorStr = 'rgb(' + data.r + ',' + data.g + ',' + data.b + ')';

                        purpleCube.setAttribute('material', {color:colorStr});

                        purpleCube.setAttribute('id', 'myBlueBox');
                        
                    }
                       
                    
                });

                socket.on('redBox_changed', (data) => {
                    var sceneEl = document.querySelector('a-scene'); 
                    
                    purpleCube  = document.querySelector('#purpleBox');

                    if(purpleCube != null){ 
                        let colorStr = 'rgb(' + data.r + ',' + data.g + ',' + data.b + ')';

                        purpleCube.setAttribute('material', {color:colorStr});
                        
                        purpleCube.setAttribute('id', 'myRedBox');


                        redCube  = document.querySelector('#purpleBox');

                        newLength3 = els3.push(redCube);
                        ids3 ++;
                        console.log(newLength3);
                        console.log(els3);

                        if(redCube != null){
                            redCube.addEventListener('click', function(){
                                socket.emit('disableRed');
                                }); 
                        }   
                        
                    }
                       
                    
                });

                let ids3 = 0; 
                var els3 = [];
                let newLength3 = 0;

                socket.on('redBox_disabled', (data) => {
                    var sceneEl = document.querySelector('a-scene'); 
                    
                    blueCube  = document.querySelector('#myRedBox');

                    if(blueCube != null){ 
                        let colorStr = 'rgb(' + data.r + ',' + data.g + ',' + data.b + ')';

                        blueCube.setAttribute('material', {color:colorStr});

                        blueCube.setAttribute('id', 'redBox');

                        purpleCube  = document.querySelector('#redBox');

                        newLength = els.push(purpleCube);
                        ids ++;
                        //console.log(newLength);
                        //console.log(els);
                        if(purpleCube != null){
                            purpleCube.addEventListener('click', function(){
                                socket.emit('purpleBox2');
                            }); 
                        }
                        
                    }
                       
                    
                });

                socket.on('blueBox_disabled', (data) => {
                    var sceneEl = document.querySelector('a-scene'); 
                    
                    blueCube  = document.querySelector('#myBlueBox');

                    if(blueCube != null){ 
                        let colorStr = 'rgb(' + data.r + ',' + data.g + ',' + data.b + ')';

                        blueCube.setAttribute('material', {color:colorStr});
                        blueCube.setAttribute('class', 'box');

                        blueCube.setAttribute('id', 'blueBox');
                        
                    }
                       
                    
                });
           

            });
       
        </script>
    </body>
</html>
